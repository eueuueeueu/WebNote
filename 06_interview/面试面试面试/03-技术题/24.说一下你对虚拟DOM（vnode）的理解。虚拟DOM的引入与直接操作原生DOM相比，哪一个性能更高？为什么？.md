# 24.说一下你对虚拟DOM（vnode）的理解。虚拟DOM的引入与直接操作原生DOM相比，哪一个性能更高？为什么？

## 回答重点

虚拟 DOM (Virtual DOM) 是由现代前端框架（比如 React）引入的一种高效管理和更新用户界面的技术。虚拟 DOM 本质上是一个轻量级的 JavaScript 对象，它用来表示真实 DOM 的结构。当状态改变时，React 会创建一个新的虚拟 DOM 树与之前的虚拟 DOM 树进行比较（这个过程被称为 "diffing"），找到变化的部分，然后只更新真实 DOM 中发生变化的元素。

和直接操作原生 DOM 相比，虚拟 DOM 能显著提高性能。原因主要是：

1）虚拟 DOM 避免了大量的直接 DOM 操作。直接操作 DOM 是昂贵的，因为浏览器需要重新计算样式、布局和进行重绘。而虚拟 DOM 的 diffing 和 batch update(批量更新) 能大大减少这种昂贵的操作次数。 

2）虚拟 DOM 提供了更高层次的抽象，使得开发者能以声明的方式编写 UI 代码，而不需要关心如何高效地执行 DOM 操作。

## 扩展知识

1）**什么是 diff 算法？**：在 React 中，diff 算法通过先前的虚拟 DOM 树和当前的虚拟 DOM 树进行比较，找出需要更新的部分，然后以最小代价去修改对应的真实 DOM。React 使用了一些优化策略，如分层比较（同级比较）、假设同一层的两个节点是不同类型的（直接删除旧节点并插入新节点）等，从而使 diff 操作非常高效。

2）**Batch Update（批量更新）：**：当状态多次改变时，React 不会立即更新 DOM，而是会把这些状态变化收集起来，进行 batch update。这样可以避免多次重复操作 DOM，进一步提高性能。

3）**Fiber 架构：**：React 16 之后引入了 Fiber 架构，这是对虚拟 DOM 的底层实现进行的一次重大升级。Fiber 使得 React 能够中断长时间的渲染任务，从而保持动画和响应的流畅性。

4）**虚拟 DOM 的缺点：**：尽管虚拟 DOM 有诸多优点，但它并不是万能的。例如，它增加了 JavaScript 的计算量，如果实际的 UI 操作非常简单，那么虚拟 DOM 可能并不会显著提高性能。

